<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI-Native Computing - Lab Notes</title>
  <style>
    :root {
      --bg: #1b1d1f;
      --fg: #e5e7eb;
      --accent: #4aa3df;
      --subtle: #a0a4a8;
      --link: #3b82f6;
      --link-hover: #60a5fa;
      --code-bg: #2b2e31;
      --code-fg: #f0f0f0;
      --border: #2d3235;
      --font-stack: 'Inter', 'Segoe UI', 'Helvetica Neue', sans-serif;
    }

    body {
      font-family: var(--font-stack);
      background-color: var(--bg);
      color: var(--fg);
      margin: 2rem auto;
      max-width: 820px;
      padding: 0 1rem;
      line-height: 1.7;
      font-size: 1.06rem;
      letter-spacing: 0.01em;
    }

    h1, h2, h3, h4, h5, h6 {
      color: var(--fg);
      margin-top: 2.2rem;
      margin-bottom: 1.2rem;
      line-height: 1.25;
      font-weight: 600;
    }

    h1 {
      font-size: 2.1rem;
    }

    h2 {
      font-size: 1.6rem;
    }

    h3 {
      font-size: 1.3rem;
    }

    .post {
      margin-bottom: 2.5rem;
      padding-left: 1rem;
      border-left: 3px solid var(--border);
    }

      .post a {
        color: var(--link);
        font-weight: 500;
        text-decoration: none;
        transition: color 0.2s ease;
        cursor: pointer;
      }

        .post a:hover {
          color: var(--link-hover);
        }

      .post small {
        display: block;
        color: var(--subtle);
        margin-top: 0.4rem;
        font-size: 0.85rem;
      }

    #content {
      padding-bottom: 4rem;
    }

    #back {
      display: inline-block;
      margin-top: 1rem;
      font-size: 0.9rem;
      color: var(--subtle);
      text-decoration: underline;
      cursor: pointer;
    }

    code, pre {
      background-color: var(--code-bg);
      color: var(--code-fg);
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.95rem;
    }

    pre {
      display: block;
      overflow-x: auto;
      margin: 1.2rem 0;
      padding: 1rem;
      line-height: 1.6;
      border: 1px solid var(--border);
    }

    blockquote {
      border-left: 4px solid var(--border);
      padding-left: 1rem;
      margin: 1.5rem 0;
      color: var(--subtle);
      font-style: italic;
    }

    hr {
      border: 0;
      border-top: 1px solid var(--border);
      margin: 2rem 0;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

  <h1 id="blog-title">ðŸ“˜ AI-Native Computing - Lab Notes</h1>
  <div id="blog-list">Loading...</div>
  <div id="content" style="display: none;"></div>
  <div id="back" style="display: none;" onclick="goHome()">Back</div>

  <script>
    async function fetchMetadata(filename) {
      const res = await fetch(`blog/${filename}`);
      const text = await res.text();
      const matchString = /^---([\s\S]*?)---/
      const metaMatch = text.match(matchString);
      if (!metaMatch) { return null; }

      const metaLines = metaMatch[1].trim().split('\n');
      const meta = {};
      metaLines.forEach(line => {
        const [key, ...rest] = line.split(':');
        meta[key.trim()] = rest.join(':').trim();
      });

      meta.slug = filename.replace(/\.md$/, '');
      meta.filename = filename;
      meta.body = text.replace(matchString, '').trim();
      return meta;
    }

    async function loadBlogIndex() {
      const listEl = document.getElementById('blog-list');

      try {
        const res = await fetch('blog/files.json');
        const postsWrapper = await res.json();
        const posts = postsWrapper.value;

        // Clean up
        posts.forEach(post => {
          for (let key in post) {
            if (typeof post[key] === 'string') {
              post[key] = post[key].replace(/\r/g, '');
            }
          }
        });

        // Sort newest first
        posts.sort((a, b) => new Date(b.date) - new Date(a.date));

        listEl.innerHTML = posts.map(post => `
        <div class="post">
          <a onclick="showPost('${post.slug}')">${post.title}</a>
          <small>${post.date}</small>
          <p>${post.description}</p>
        </div>
      `).join('');
      } catch (err) {
        listEl.innerHTML = `<p style="color: red;">Failed to load blog index.</p>`;
        console.error("Failed to fetch blog index: ", err);
      }
    }

    async function showPost(slug) {
      try {
        const res = await fetch(`blog/files.json`);
        const postsWrapper = await res.json();
        const posts = postsWrapper.value;
        const post = posts.find(p => p.slug === slug);

        if (!post) {
          document.getElementById('content').innerHTML = '<p>Post Not Found</p>';
          return;
        }

        const fileRes = await fetch(`blog/${post.filename}`);
        const text = await fileRes.text();
        const content = text.replace(/^---[\s\S]*?---/, '').trim();
        const html = marked.parse(content);

        document.title = post.title + ' | My Blog'
        document.getElementById('blog-list').style.display = 'none';
        document.getElementById('blog-title').innerText = '';
        document.getElementById('content').style.display = 'block';
        document.getElementById('back').style.display = 'inline-block';
        document.getElementById('content').innerHTML = html;

        history.pushState({}, '', `?post=${slug}`);
      } catch (err) {
        document.getElementById('content').innerHTML = '<p>Error loading post.</p>';
        console.error("Failed to load blog post:", err);
      }
    }

    function goHome() {
      document.title = 'My Blog';
      history.pushState({}, '', window.location.pathname);
      document.getElementById('blog-list').style.display = 'block';
      document.getElementById('blog-title').innerText = 'ðŸ“˜ Blog';
      document.getElementById('content').style.display = 'none';
      document.getElementById('back').style.display = 'none';
    }

    // Deep link support
    function checkUrl() {
      const params = new URLSearchParams(window.location.search);
      const slug = params.get('post');
      if (slug) {
        showPost(slug);
      } else {
        loadBlogIndex();
      }
    }

    checkUrl();

    window.addEventListener('popstate', () => {
      const params = new URLSearchParams(window.location.search);
      const slug = params.get('post');

      if (slug) {
        showPost(slug);
      } else {
        goHome();
      }
    });


  </script>

</body>
</html>
